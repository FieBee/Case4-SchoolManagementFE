<!DOCTYPE html>
<html lang="en">
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>Title</title>-->
<!--  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<!--  &lt;!&ndash; Latest compiled and minified CSS &ndash;&gt;-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  &lt;!&ndash; Latest compiled JavaScript &ndash;&gt;-->
<!--  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>-->
<!--  <link rel="stylesheet" href="admin.css">-->

<!--  <script-->
<!--          src="https://code.jquery.com/jquery-3.3.1.js"-->
<!--          integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="-->
<!--          crossorigin="anonymous">-->
<!--  </script>-->

<!--  <script>-->
<!--    $(function () {-->
<!--      $("#header").load("fragment/header.html");-->
<!--      $("#footer").load("fragment/footer.html");-->
<!--    });-->
<!--    checkLogin();-->
<!--  </script>-->
<!--</head>-->


<head >
  <!-- basic -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- mobile metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <!-- site metas -->
  <title>selo</title>
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- bootstrap css -->
  <!--      <link rel="stylesheet" href="css/bootstrap.min.css">-->
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <!-- style css -->

  <!-- Responsive-->
  <link rel="stylesheet" href="../css/responsive.css">
  <!-- fevicon -->
  <!--      <link rel="icon" href="images/fevicon.png" type="image/gif" />-->
  <!-- Scrollbar Custom CSS -->
  <link rel="stylesheet" href="../css/jquery.mCustomScrollbar.min.css">
  <!-- Tweaks for older IEs-->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">

  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>-->
  <!--      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>-->
  <!--      <![endif]&ndash;&gt;-->



  <link rel="stylesheet" href="../css/style.css">


  <script
          src="https://code.jquery.com/jquery-3.3.1.js"
          integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
          crossorigin="anonymous">
  </script>

  <script>
    $(function () {
      $("#header").load("fragment/header.html");
      $("#footer").load("fragment/footer.html");
    });

// checkLogin()
  </script>

</head>

<script>

  function displayFormCreate() {
    document.getElementById("form1").reset()
    document.getElementById("form1").hidden = false;
  }

  function getTeacher(teacher) {
    return `<tr>
<td >${teacher.firstName}</td><td >${teacher.lastName}</td><td >${teacher.birth}</td><td >${teacher.email}</td><td >${teacher.phone}</td>

                <td >${teacher.account.account}</td>
                <td >${teacher.account.password}</td>
                <td >${teacher.active}</td>
                <td >${teacher.image}</td>

                <td><a href="${teacher.id}" onclick="showFormUpdate(this)">Edit</a></td>
                <td><a href="${teacher.id}" onclick="deleteTeacher(this)">Delete</a></td>
                </tr>`
  }


  function successHandler() {
    $.ajax({
      type: "GET",
      url: "http://localhost:8080/teacher",
      success: function (data) {
        console.log(data)
        let content =
                `<tr>
                        <td>First Name</td>
                        <td>Last Name</td>
                        <td>Birth Date</td>
                        <td>Email</td>
                        <td>Phone</td>
                        <td>Account</td>
                        <td>Password</td>
                        <td>Status</td>
                        <td>Image</td>
                        <td>Edit</td>
                        <td>Delete</td>
                    </tr>`;
        if (data == null) {
          document.getElementById("teacherList").innerHTML = content;
        } else {
          for (let i = 0; i < data.content.length; i++) {
            content += getTeacher(data.content[i]);
          }
          document.getElementById("teacherList").innerHTML = content;
        }
      }
    })
  }
  successHandler();



  function addNewAccount(){
    let account = $('#account').val();
    let password = $('#password').val();
    let newAccount = {
      account: account,
      password: password
    }
    // console.log(newAccount)
    $.ajax({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      type: "POST",
      data: JSON.stringify(newAccount),
      //tên API
      url: "http://localhost:8080/account",
      //xử lý khi thành công
      success: function (data){
        console.log("tao account thanh cong")
        console.log(data.id)
        let firstName = $('#firstName').val();
        let lastName = $('#lastName').val();
        let birthDate = $('#birthDate').val();
        let email = $('#email').val();
        let phone = $('#phone').val();
        let active = $('#active').val();
        let newTeacher = {
          firstName: firstName,
          lastName: lastName,
          birthDate: birthDate,
          email: email,
          phone: phone,
          account: {
            id : data.id
          },
          active: active,
        };
        $.ajax({
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          type: "POST",
          data: JSON.stringify(newTeacher),
          //tên API
          url: "http://localhost:8080/teacher",
          //xử lý khi thành công
          success: function (data){
            successHandler()
            alert("Thêm thành công")
            console.log(data)
          }
        })
        event.preventDefault();
      }
    })
    event.preventDefault();
  }


  //// Upload file

  // function addNewAccount(){
  //   let formData = new FormData();
  //   let account = $('#account').val();
  //   let password = $('#password').val();
  //   formData.append('account', account)
  //   formData.append('password', password)
  //   // console.log(newAccount)
  //   $.ajax({
  //     contentType: false,
  //     processData: false,
  //     enctype: 'multipart/form-data',
  //     dataType: "json",
  //     type: "POST",
  //     url: "http://localhost:8080/account",
  //     data: formData,
  //
  //     success: function (data){
  //       console.log("tao account thanh cong")
  //       console.log(data.id)
  //
  //       let formData = new FormData();
  //       let firstName = $('#firstName').val();
  //       let lastName = $('#lastName').val();
  //       let birthDate = $('#birthDate').val();
  //       let email = $('#email').val();
  //       let phone = $('#phone').val();
  //       let active = $('#active').val();
  //       formData.append('firstname', firstName)
  //       formData.append('lastname', lastName)
  //       formData.append('birthDate', birthDate)
  //       formData.append('email', email)
  //       formData.append('phone', phone)
  //       formData.append('active', active)
  //       formData.append('account', data.id)
  //       $.ajax({
  //         contentType: false,
  //         processData: false,
  //         enctype: 'multipart/form-data',
  //         dataType: "json",
  //         type: "POST",
  //         url: "http://localhost:8080/teacher",
  //         data: formData,
  //         success: function (data){
  //           successHandler()
  //           alert("Thêm thành công")
  //           console.log(data)
  //         }
  //       })
  //       event.preventDefault();
  //     }
  //   })
  //   event.preventDefault();
  // }


  function deleteTeacher(element){
    let id = element.getAttribute("href");
    $.ajax({
      type: "DELETE",
      url: `http://localhost:8080/teacher/`+id,
      //xử lý khi thành công
      success: function () {
        successHandler();
      },
    });
    event.preventDefault();
  }

  function showFormUpdate(element){
    let id = element.getAttribute("href");
    console.log(id);
    $.ajax({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      type: "GET",
      url: `http://localhost:8080/teacher/${id}`,
      success: function (data) {
        console.log(data);
        console.log(id);
        $('#id').attr('value',`${data.id}`)
        $('#firstName').attr('value',`${data.firstName}`)
        $('#lastName').attr('value',`${data.lastName}`)
        $('#birthDate').attr('value',`${data.birth}`)
        $('#email').attr('value',`${data.email}`)
        $('#phone').attr('value',`${data.phone}`)
        $('#account').attr('value',`${data.account.account}`)
        $('#password').attr('value',`${data.account.password}`)
        $('#active').attr('value',`${data.active}`)
      }
    })
    event.preventDefault();
  }

  function updateTeacher() {
    let id = $('#id').val();
    let account = $('#account').val();
    let password = $('#password').val();
    let accounts = {
      account: account,
      password: password
    }
    $.ajax({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      type: "PUT",
      url: "http://localhost:8080/account/" + id,
      data: JSON.stringify(accounts),
      success: function (data){
        console.log("tao account thanh cong")
        console.log(data.id)
        let id = $('#id').val();
        let firstName = $('#firstName').val();
        let lastName = $('#lastName').val();
        let birthDate = $('#birthDate').val();
        let email = $('#email').val();
        let phone = $('#phone').val();
        let active = $('#active').val();
        let teachers = {
          firstName: firstName,
          lastName: lastName,
          birthDate: birthDate,
          email: email,
          phone: phone,
          account: {
            id : data.id
          },
          active: active,
        };
        $.ajax({
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          type: "PUT",
          url: "http://localhost:8080/teacher/" + id,
          data: JSON.stringify(teachers),
          success: function (data){
            successHandler()
            alert("Sửa thành công")
            console.log(data)
          }
        })
        event.preventDefault();
      }
    })
    event.preventDefault();
  }

  function searchStudent(){
    let search= $('#search').val();
    $.ajax({
      headers:{
        'Accept':'application/json',
        'Content-Type': 'application/json'
      },
      type:"GET",
      url:`http://localhost:8080/teacher?search=${search}`,
      success:function (data){
        console.log(data);

        let str = '    <tr>\n' +
                '        <td>First Name</td>\n' +
                '        <td>Last Name</td>\n' +
                '        <td>Birth</td>\n' +
                '        <td>Address</td>\n' +
                '        <td>Email</td>\n' +
                '        <td>Phone</td>\n' +
                '        <td>Account</td>\n' +
                '        <td>Password</td>\n' +
                '        <td>Active</td>\n' +
                '        <td>Edit</td>\n' +
                '        <td>Delete</td>\n' +
                '    </tr>';

        for (let i = 0; i < data.content.length; i++) {
          str += getStudent(data.content[i]);
          console.log("hello")
        }
        console.log(str)
        document.getElementById('teacherList').innerHTML = str;

// >>>>>>> home
//       url: `http://localhost:8080/teacher/${id}`,
//       data:JSON.stringify(teacher),
//       success: function (data) {
//         console.log(id);
//         successHandler();
// >>>>>>> home
      }
    })
    event.preventDefault();
  }

</script>
<body class="main-layout inner_header about_page">



  <header id="header"></header>
  <br><br>

  <div class="container">
    <h1>Teacher List</h1>
    <br>

    <div>
      <table id="teacherList" class="table table-striped"></table>
    </div>

    <form >
      <input type="text" id="search" name="search" placeholder="search">
      <input type="submit" value="Search" onclick="searchStudent()">
    </form>

    <button class="btn btn-primary" onclick="displayFormCreate()">Create new teacher</button>

    <form id="form1" hidden>
      <input type="hidden" id="id" placeholder="id">
      <div class="mb-3 mt-3">
        <label for="firstName" class="form-label">First Name:</label>
        <input type="text" class="form-control" id="firstName" placeholder="Enter first name">
      </div>
      <div class="mb-3">
        <label for="lastName" class="form-label">Last Name:</label>
        <input type="text" class="form-control" id="lastName" placeholder="Enter last name">
      </div>
      <div class="mb-3">
        <label for="birthDate" class="form-label">Birth Date:</label>
        <input type="text" class="form-control" id="birthDate" placeholder="Enter birth date">
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email:</label>
        <input type="text" class="form-control" id="email" placeholder="Enter email">
      </div>
      <div class="mb-3">
        <label for="phone" class="form-label">Phone:</label>
        <input type="text" class="form-control" id="phone" placeholder="Enter phone">
      </div>
      <div class="mb-3">
        <label for="account" class="form-label">Account:</label>
        <input type="text" class="form-control" id="account" placeholder="Enter account">
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password:</label>
        <input type="password" class="form-control" id="password" placeholder="Enter password">
      </div>
      <div class="mb-3">
        <label for="file" class="form-label">File:</label>
        <input type="file" class="form-control" id="file" name="file">
      </div>
      <button type="submit" id="form-button" class="btn btn-primary" onclick="addNewAccount()">Submit</button>
      <button type="submit" class="btn btn-primary" onclick="updateTeacher()">Update</button>
    </form>
  </div>


<footer id="footer"></footer>
</body>
</html>